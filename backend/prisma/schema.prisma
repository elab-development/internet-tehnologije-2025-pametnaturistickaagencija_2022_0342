generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  GUEST
  USER
  ADMIN
}

enum SenderType {
  USER
  AI
}

enum OfferType {
  HOTEL
  FLIGHT
  PACKAGE
  OTHER
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  firstName String  @map("first_name")
  lastName  String  @map("last_name")
  role      Role    @default(USER)
  phone     String? @map("phone")

  savedOffers SavedOffer[]
  chats       Chat[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user")
}

model SavedOffer {
  id        Int        @id @default(autoincrement())
  userId    Int        @map("user_id")
  name      String
  price     Decimal    
  siteLinks Json       @map("site_links")
  offerType OfferType  @map("offer_type")
  date      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@map("saved_offer")
}

model Chat {
  id          Int      @id @default(autoincrement())
  userId      Int
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  chatName String?
  destination String?
  summary     String?
  preferences Json?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  messages    Message[]

  @@index([userId])
}

model Message {
  id        Int      @id @default(autoincrement())
  chatId    Int
  role      String   // "user" | "assistant" | "system"
  content   String   // raw text OR JSON string (assistant)
  createdAt DateTime @default(now())

  chat      Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([chatId])
  @@index([createdAt])
}